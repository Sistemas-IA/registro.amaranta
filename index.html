<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Registro</title>
  <!-- reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6Le2sYMrAAAAABmpey7GOWmQHVua3PxJ5gnHsbGp"></script>
  <style>
    .error-message { color: #c00; margin: 0.5em 0; }
    #error-container { display: none; color: #c00; margin-bottom: 1em; }
    form input { display: block; margin: 0.5em 0; padding: 0.5em; width: 200px; }
    form button { padding: 0.5em 1em; }
  </style>
</head>
<body>
  <h1>Formulario de Registro</h1>
  <div id="error-container"></div>
  <form id="register-form" novalidate>
    <input type="text" id="nombre" name="nombre" maxlength="50" placeholder="Nombre" />
    <input type="email" id="email" name="email" placeholder="Email" />
    <button type="submit">Enviar</button>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('register-form');
      const errorContainer = document.getElementById('error-container');

      form.addEventListener('submit', async e => {
        e.preventDefault();
        errorContainer.style.display = 'none';
        errorContainer.textContent = '';

        const nombre = form.nombre.value.trim();
        const email = form.email.value.trim();

        // ValidaciÃ³n frontend
        if (!nombre || !email) {
          errorContainer.textContent = 'Nombre y email son obligatorios.';
          errorContainer.style.display = 'block';
          return;
        }

        try {
          // Obtener token reCAPTCHA
          await grecaptcha.ready();
          const token = await grecaptcha.execute(
            '6Le2sYMrAAAAABmpey7GOWmQHVua3PxJ5gnHsbGp',
            { action: 'register' }
          );

          // Llamada AJAX
          const response = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ nombre, email, recaptchaToken: token })
          });
          const result = await response.json();

          if (response.ok && result.ok) {
            alert('Registro exitoso ðŸŽ‰');
            form.reset();
          } else {
            alert('Error: ' + (result.error || 'Algo saliÃ³ mal'));
          }
        } catch (err) {
          console.error('Error al enviar:', err);
          alert('No se pudo conectar con el servidor o reCAPTCHA fallÃ³.');
        }
      });
    });
  </script>
</body>
</html>
